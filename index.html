<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <title>RubicCage</title>
    <link rel="stylesheet" href="./base.css">
    <script type="text/javascript" src="./socket.io/socket.io.js"></script>
  </head>
  <body>
    <table>
      <!-- ↓矢印 -->
      <tr>
        <td><img src = "./img/blank.gif"></td>
        <td><img src = "./img/down.gif" id = "down_left"></td>
        <td><img src = "./img/down.gif" id = "down_center"></td>
        <td><img src = "./img/down.gif" id = "down_right"></td>
        <td><img src = "./img/blank.gif"></td>
      </tr>
      <!-- 0段目 -->
      <tr>
        <td><img src = "./img/left.gif" id = "left0"></td>
        <td><img src = "./img/blank.gif" class="cage" id="cage00"></td>
        <td><img src = "./img/blank.gif" class="cage" id="cage01"></td>
        <td><img src = "./img/blank.gif" class="cage" id="cage02"></td>
        <td><img src = "./img/right.gif" id = "right0"></td>
      </tr>
      <!-- 1段目 -->
      <tr>
        <td><img src = "./img/left.gif" id = "left1"></td>
        <td><img src = "./img/blank.gif" class="cage" id="cage10"></td>
        <td><img src = "./img/blank.gif" class="cage" id="cage11"></td>
        <td><img src = "./img/blank.gif" class="cage" id="cage12"></td>
        <td><img src = "./img/right.gif" id = "right1"></td>
      </tr>
      <!-- 2段目 -->
      <tr>
        <td><img src = "./img/left.gif" id = "left2"></td>
        <td><img src = "./img/blank.gif" class="cage" id="cage20"></td>
        <td><img src = "./img/blank.gif" class="cage" id="cage21"></td>
        <td><img src = "./img/blank.gif" class="cage" id="cage22"></td>
        <td><img src = "./img/right.gif" id = "right2"></td>
      </tr>
      <!-- その他操作 -->
      <tr>
        <td><img src = "./img/hidari.png" id="hidari"></td>
        <td><img src = "./img/reset.png" id="reset"></td>
        <td><img src = "./img/rotate.gif" id="rotate"></td>
        <td><img src = "./img/blank.gif"></td>
        <td><img src = "./img/migi.png" id="migi"></td>
      </tr>
    </table>
    
    <script type="text/javascript">
      let socket = io.connect();
      let down_left_action = document.getElementById('down_left');
      let down_center_action = document.getElementById('down_center');
      let down_right_action = document.getElementById('down_right');
      let left0_action = document.getElementById('left0');
      let cage00 = document.getElementById('cage00');
      let cage01 = document.getElementById('cage01');
      let cage02 = document.getElementById('cage02');
      let right0_action = document.getElementById('right0');
      let left1_action = document.getElementById('left1');
      let cage10 = document.getElementById('cage10');
      let cage11 = document.getElementById('cage11');
      let cage12 = document.getElementById('cage12');
      let right1_action = document.getElementById('right1');
      let left2_action = document.getElementById('left2');
      let cage20 = document.getElementById('cage20');
      let cage21 = document.getElementById('cage21');
      let cage22 = document.getElementById('cage22');
      let right2_action = document.getElementById('right2');
      let hidari_action = document.getElementById('hidari');
      let reset_action = document.getElementById('reset');
      let rotate_action = document.getElementById('rotate');
      let migi_action = document.getElementById('migi');
      let cagelist;

      socket.on("server_to_client", function(data){
        cagelist = data;
        cage00.src=cagelist[0][0];
        cage01.src=cagelist[0][1];
        cage02.src=cagelist[0][2];
        cage10.src=cagelist[1][0];
        cage11.src=cagelist[1][1];
        cage12.src=cagelist[1][2];
        cage20.src=cagelist[2][0];
        cage21.src=cagelist[2][1];
        cage22.src=cagelist[2][2];
      });

      function butonClick(e){
        if(window.confirm("手を確定します")){
          socket.emit("client_to_server", {value : e.target.id});
        }
      }
      
      function cage_reload(e){
        socket.emit("client_to_server", "cage_reload");
      }

      function migi_mawasu(){
        cage00.src=cagelist[0][3];
      }

      window.onload= cage_reload;
      down_left_action.addEventListener('click', butonClick);
      down_center_action.addEventListener('click', butonClick);
      down_right_action.addEventListener('click', butonClick);
      left0_action.addEventListener('click', butonClick);
      right0_action.addEventListener('click', butonClick);
      left1_action.addEventListener('click', butonClick);
      right1_action.addEventListener('click', butonClick);
      left2_action.addEventListener('click', butonClick);
      right2_action.addEventListener('click', butonClick);
      hidari_action.addEventListener('click', butonClick);
      rotate_action.addEventListener('click', butonClick);
      migi_action.addEventListener('click', migi_mawasu);

      // $("form").submit(function(e){
      //     var message = $("#msgForm").val();
      //     $("#msgForm").val('');
      //     socket.emit("client_to_server", {value : message});
      //     e.preventDefault();
      // });
    </script>
  </body>
</html>